{{ define "head" }}
  {{ partial "style.html" (dict "css" "css/quote.css") }}
{{ end }}

{{ define "config" }}
    {{ .Scratch.Set "noIndex" true }} 
{{ end }}

{{ define "main" }}
<main class="main">
    <div class="quote-list-page">

        <header class="quote-list-header">
            <h1>ðŸŒŸ {{ .Title }}</h1>
            <p>
                {{ .Description }}
            </p>
        </header>

        <div class="quote-filters" aria-label="Filter kutipan">
            <button class="filter-btn active" data-filter="all">Semua</button>
            {{ $allCategories := slice }}
            {{ range .Pages }}
                {{ with .Params.categories }}
                    {{ $allCategories = $allCategories | append . }}
                {{ end }}
            {{ end }}
            
            {{ $uniqueCategories := uniq (sort $allCategories) }}
            {{ range $uniqueCategories }}
                <button class="filter-btn" data-filter="{{ . }}">{{ . }}</button>
            {{ end }}
        </div>

        <div class="quotes-grid">
            {{ range .Pages }}
            <article class="quote-card" data-cats="{{ delimit .Params.categories "|" }}">
                <div class="quote-content">{{ .Content | safeHTML }}</div>
                <div class="quote-meta">
                    <div class="quote-attribution">
                        <div class="quote-author">
                        {{ with .Params.author }}
                            - {{ . }}
                        {{ else }}
                            â€” Anonymous
                        {{ end }}
                        </div>
                        <div class="quote-date">{{ .Date.Format "2 January 2006" }}</div>
                    </div>
                    <button class="quote-copy" title="Salin kutipan" data-target="quote-{{ .File.UniqueID }}">
                        <i class="ri-file-copy-line"></i>
                    </button>
                </div>
                <textarea id="quote-{{ .File.UniqueID }}" class="quote-hidden">{{ .Plain }}</textarea>
            </article>
            {{ end }}
        </div>
    </div>
</main>
{{ end }}

{{ define "footer" }}

    <script>
    document.addEventListener('DOMContentLoaded', function(){
        const cards = Array.from(document.querySelectorAll('.quote-card'));
        const filtersContainer = document.querySelector('.quote-filters');

        function applyFilter(filter) {
            // Set active class on the correct button
            filtersContainer.querySelectorAll('.filter-btn').forEach(function(b) {
                b.classList.remove('active');
            });
            const activeBtn = filtersContainer.querySelector(`.filter-btn[data-filter="${filter}"]`);
            if (activeBtn) {
                activeBtn.classList.add('active');
            }

            // Show or hide cards based on the filter
            cards.forEach(function(c) {
                const cats = c.getAttribute('data-cats') || '';
                const shouldShow = (filter === 'all') || cats.split('|').includes(filter);
                c.style.display = shouldShow ? '' : 'none';
            });
        }

        // Filter logic
        filtersContainer.addEventListener('click', function(e){
            if(!e.target || !e.target.classList.contains('filter-btn')) return;
            
            const filter = e.target.getAttribute('data-filter');
            applyFilter(filter);

            // Update URL without reloading the page
            const url = new URL(window.location);
            if (filter === 'all') {
                url.searchParams.delete('filter');
            } else {
                url.searchParams.set('filter', filter);
            }
            window.history.pushState({}, '', url);
        });

        // Copy logic (delegated)
        document.addEventListener('click', function(e){
        var copyButton = e.target.closest('.quote-copy');
        if(copyButton){
            var id = copyButton.getAttribute('data-target');
            var ta = document.getElementById(id);
            if(!ta) return;

            var originalContent = copyButton.innerHTML;
            var successContent = '<i class="ri-check-line"></i>';

            function showSuccess(button) {
                button.innerHTML = successContent;
                setTimeout(function() {
                    button.innerHTML = originalContent;
                }, 1200);
            }

            var text = ta.value || ta.innerText || ta.textContent;
            if(navigator.clipboard){ 
                navigator.clipboard.writeText(text).then(function() { showSuccess(copyButton); }); 
            }
            else {
                ta.select(); 
                try { 
                    document.execCommand('copy'); 
                    showSuccess(copyButton);
                } catch(err) {
                    console.warn(err)
                }
            }
        }
        });

        // On page load, check for a filter in the URL
        const urlParams = new URLSearchParams(window.location.search);
        const filterFromUrl = urlParams.get('filter');
        if (filterFromUrl) {
            applyFilter(filterFromUrl);
        }
    });
    </script>

{{ end }}