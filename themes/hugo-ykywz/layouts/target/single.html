{{ define "main" }}
{{ $password := .Params.password }}
{{ $passwordHash := "" }}
{{ if $password }}
    {{ $passwordHash = sha256 $password }}
{{ end }}
<div id="ajax-content" class="min-h-screen bg-gray-50 dark:bg-gray-950 transition-colors duration-300">
<div class="bg-gray-50 dark:bg-gray-950 text-gray-900 dark:text-gray-100 font-sans antialiased lg:py-12 selection:bg-indigo-500 selection:text-white"
    x-data="{
        locked: {{ if $password }}true{{ else }}false{{ end }},
        passwordInput: '',
        error: '',
        async init() {
            {{ if $password }}
            const storageKey = 'target_unlock_' + window.location.pathname;
            if (localStorage.getItem(storageKey) === '{{ $passwordHash }}') {
                this.locked = false;
                return;
            }

            const urlParams = new URLSearchParams(window.location.search);
            const passwordParam = urlParams.get('password');
            if (passwordParam) {
                const hash = await this.sha256(passwordParam);
                if (hash === '{{ $passwordHash }}') {
                    this.locked = false;
                    localStorage.setItem(storageKey, hash);
                }
            }
            {{ end }}
        },
        async sha256(message) {
            const msgBuffer = new TextEncoder().encode(message);
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        },
        async checkPassword() {
            this.error = '';
            if (!this.passwordInput) return;
            const hash = await this.sha256(this.passwordInput);
            if (hash === '{{ $passwordHash }}') {
                this.locked = false;
                localStorage.setItem('target_unlock_' + window.location.pathname, hash);
            } else {
                this.error = 'Password yang Anda masukkan salah.';
                this.passwordInput = '';
            }
        }
    }">

    <!-- Lock Screen -->
    <div x-show="locked" class="min-h-[60vh] flex flex-col items-center justify-center p-6" style="display: none;">
        <div class="bg-white dark:bg-gray-900 p-8 rounded-3xl shadow-xl border border-gray-200 dark:border-gray-800 max-w-md w-full text-center">
            <div class="w-16 h-16 bg-indigo-100 dark:bg-indigo-900/30 rounded-2xl flex items-center justify-center text-indigo-600 dark:text-indigo-400 text-3xl mb-6 mx-auto">
                <i class="icon-[ri--lock-2-line]"></i>
            </div>
            <h2 class="text-2xl font-bold mb-2 text-gray-900 dark:text-white">Konten Terkunci</h2>
            <p class="text-sm text-gray-500 dark:text-gray-400 mb-6">Masukkan password untuk melihat detail resolusi ini.</p>
            
            <form @submit.prevent="checkPassword" class="space-y-4">
                <input type="text" x-model="passwordInput" @input="error = ''" class="w-full px-4 py-3 rounded-xl border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 focus:ring-2 focus:ring-indigo-500 outline-none transition-all text-center font-bold tracking-widest text-gray-900 dark:text-white" placeholder="••••••" autofocus>
                <button type="submit" class="w-full py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-xl transition-colors shadow-lg shadow-indigo-500/20">
                    Buka Kunci
                </button>
                <p x-show="error" x-text="error" class="text-red-500 text-xs pt-2" style="display: none;"></p>
            </form>
        </div>
    </div>

    <div x-show="!locked" x-transition.opacity.duration.500ms class="max-w-5xl mx-auto shadow-xl md:rounded-3xl overflow-hidden bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-800" style="display: none;">
        <header class="p-8 md:p-12 border-b border-gray-100 dark:border-gray-800">
            <div class="flex items-center gap-2 mb-6">
                <a href="{{ .Parent.RelPermalink }}" class="px-3 py-1 bg-indigo-600 text-white text-[10px] font-bold uppercase tracking-wider rounded-lg shadow-lg shadow-indigo-500/20">
                    {{ .Parent.Title }}
                </a>
                <span class="text-[10px] font-bold text-gray-400 uppercase tracking-wider ml-2">{{ .Date.Format "2006" }}</span>
            </div>
            <h1 class="text-3xl md:text-5xl font-black tracking-tighter leading-tight mb-4 text-gray-900 dark:text-white">
                {{ .Title }}
            </h1>
            
            <div class="flex flex-wrap items-center gap-6 mt-6 text-sm text-gray-500 dark:text-gray-400">
                <div class="flex items-center gap-2">
                    <i class="icon-[ri--calendar-line]"></i>
                    <span>Dimulai: <strong class="text-gray-900 dark:text-white">{{ .Date | time.Format "2 January 2006" }}</strong></span>
                </div>
                <div class="flex items-center gap-2">
                    <i class="icon-[ri--flag-line]"></i>
                    <span>Status: 
                        <span class="font-bold uppercase 
                            {{ if eq .Params.status "Tercapai" }} text-green-600 dark:text-green-400
                            {{ else if eq .Params.status "Diusahakan" }} text-orange-600 dark:text-orange-400
                            {{ else if eq .Params.status "Dihentikan" }} text-red-600 dark:text-red-400
                            {{ else }} text-gray-500 dark:text-gray-400 {{ end }}">
                            {{ .Params.status | default "N/A" }}
                        </span>
                    </span>
                </div>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-px bg-gray-100 dark:bg-gray-800">
            
            <div class="lg:col-span-4 bg-white dark:bg-gray-900 p-8 md:p-10 space-y-12">
                <section>
                    <h2 class="text-xs font-bold uppercase tracking-wider text-gray-400 mb-6 flex items-center gap-2">
                        <span class="w-2 h-2 bg-indigo-500 rounded-full"></span> 1. Target
                    </h2>
                    <div class="space-y-3">
                        {{ range .Params.targets }}
                        <div class="bg-indigo-50 dark:bg-indigo-900/20 p-4 rounded-2xl border border-indigo-100 dark:border-indigo-800/50 flex items-center gap-4 shadow-sm">
                            <div class="w-8 h-8 bg-white dark:bg-indigo-900 rounded-full flex items-center justify-center text-indigo-600 dark:text-indigo-400 shadow-sm shrink-0 text-sm">
                                <i class="icon-[ri--target-line]"></i>
                            </div>
                            <p class="text-sm font-bold text-indigo-900 dark:text-indigo-200">{{ . }}</p>
                        </div>
                        {{ end }}
                    </div>
                </section>

                <hr class="border-gray-100 dark:border-gray-800">

                <section>
                    <h2 class="text-xs font-bold uppercase tracking-wider text-gray-400 mb-6 flex items-center gap-2">
                        <span class="w-2 h-2 bg-purple-500 rounded-full"></span> 5. Afirmasi
                    </h2>
                    <div class="space-y-4">
                    {{ if .Params.afirmasi }}
                        {{ range .Params.afirmasi }}
                            {{ if eq .type "text" }}
                                <div class="bg-purple-50 dark:bg-purple-900/20 p-6 rounded-2xl border border-purple-100 dark:border-purple-800/50 text-purple-900 dark:text-purple-300 text-sm font-bold leading-relaxed shadow-inner">
                                    "{{ .content }}"
                                </div>
                            {{ else if eq .type "image" }}
                                <div class="rounded-2xl overflow-hidden shadow-sm border border-gray-200 dark:border-gray-800">
                                    <img src="{{ .url }}" alt="Afirmasi" class="w-full h-auto object-cover" loading="lazy">
                                </div>
                            {{ else if eq .type "video" }}
                                <div class="rounded-2xl overflow-hidden shadow-sm border border-gray-200 dark:border-gray-800 aspect-video bg-black">
                                    {{ if or (in .url "youtube.com") (in .url "youtu.be") }}
                                        {{ $videoID := replaceRE "^.*(?:youtu.be\\/|v=|\\/v\\/|embed\\/|watch\\?v=)([^#\\&?]*).*" "$1" .url }}
                                        <iframe src="https://www.youtube.com/embed/{{ $videoID }}" title="Afirmasi Video" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen class="w-full h-full"></iframe>
                                    {{ else }}
                                        <video controls class="w-full h-full">
                                            <source src="{{ .url }}">
                                            Browser Anda tidak mendukung elemen video.
                                        </video>
                                    {{ end }}
                                </div>
                            {{ else if eq .type "audio" }}
                                <div class="bg-white dark:bg-gray-900 p-4 rounded-2xl border border-gray-200 dark:border-gray-800 shadow-sm flex items-center gap-4">
                                    <div class="w-10 h-10 bg-purple-100 dark:bg-purple-900/30 rounded-full flex items-center justify-center text-purple-600 dark:text-purple-400 shrink-0">
                                        <i class="icon-[ri--music-line]"></i>
                                    </div>
                                    <audio controls class="w-full h-8">
                                        <source src="{{ .url }}">
                                        Browser Anda tidak mendukung elemen audio.
                                    </audio>
                                </div>
                            {{ end }}
                        {{ end }}
                    {{ else if .Params.pengingat }}
                        <div class="bg-purple-50 dark:bg-purple-900/20 p-6 rounded-2xl border border-purple-100 dark:border-purple-800/50 text-purple-900 dark:text-purple-300 text-sm font-bold leading-relaxed shadow-inner">
                        "{{ .Params.pengingat }}"
                        </div>
                    {{ end }}
                    </div>
                </section>
            </div>

            <div class="lg:col-span-8 bg-gray-50/30 dark:bg-gray-800/10 p-8 md:p-12 space-y-20">
                
                <section>
                    <h2 class="text-xs font-bold uppercase tracking-wider text-gray-400 mb-8 flex items-center gap-2">
                        <span class="w-2 h-2 bg-blue-500 rounded-full"></span> 2. Rencana
                    </h2>
                    <div class="space-y-3">
                        {{ range $index, $element := .Params.rencana }}
                        <div class="bg-white dark:bg-gray-900 p-5 rounded-2xl border border-gray-100 dark:border-gray-800 flex gap-5 items-center shadow-sm hover:shadow-md transition-shadow">
                            <div class="w-8 h-8 bg-blue-50 dark:bg-blue-900/30 text-blue-600 rounded-xl flex items-center justify-center text-xs font-black shrink-0">{{ add $index 1 }}</div>
                            <p class="text-sm font-bold text-gray-700 dark:text-gray-200">{{ $element }}</p>
                        </div>
                        {{ end }}
                    </div>
                </section>

                <section>
                    <h2 class="text-xs font-bold uppercase tracking-wider text-gray-400 mb-8 flex items-center gap-2">
                        <span class="w-2 h-2 bg-orange-500 rounded-full"></span> 3. Aksi
                    </h2>
                    <div class="space-y-6">
                        {{ range .Params.aksi }}
                        <div class="relative pl-8 border-l-2 border-orange-500/20">
                            <div class="absolute -left-[9px] top-0 w-4 h-4 bg-orange-500 rounded-full border-4 border-white dark:border-gray-900"></div>
                            <div class="bg-white dark:bg-gray-900 p-6 rounded-2xl border border-gray-100 dark:border-gray-800 shadow-sm">
                                <span class="text-[10px] font-black text-orange-600 uppercase tracking-widest mb-2 block">{{ .tanggal }}</span>
                            <p class="text-sm font-medium leading-relaxed text-gray-600 dark:text-gray-300">"{{ .catatan }}"</p>
                            </div>
                        </div>
                        {{ end }}
                    </div>
                </section>

                <section>
                    <h2 class="text-xs font-bold uppercase tracking-wider text-gray-400 mb-8 flex items-center gap-2">
                        <span class="w-2 h-2 bg-emerald-500 rounded-full"></span> 4. Evaluasi
                    </h2>
                    <div class="space-y-4">
                        {{ range .Params.evaluasi }}
                        <div class="relative overflow-hidden bg-white dark:bg-gray-900 border {{ if eq .tipe "Baru" }}border-emerald-500/50 shadow-sm{{ else }}border-gray-100 dark:border-gray-800 opacity-60{{ end }} p-6 rounded-2xl">
                            
                            {{ if eq .tipe "Baru" }}
                            <div class="absolute top-0 left-0 w-1 h-full bg-emerald-500"></div>
                            {{ end }}

                            <div class="flex items-center gap-3 mb-3">
                                <span class="text-[9px] font-black uppercase tracking-widest {{ if eq .tipe "Baru" }}text-emerald-600 dark:text-emerald-400{{ else }}text-gray-400{{ end }}">
                                    {{ .tipe }} Decision
                                </span>
                                {{ if .tanggal }}<span class="text-[10px] text-gray-400 font-medium tracking-tighter">{{ .tanggal }}</span>{{ end }}
                            </div>

                            <p class="text-lg font-bold leading-snug {{ if eq .tipe "Baru" }}text-gray-900 dark:text-gray-100{{ else }}text-gray-500 dark:text-gray-500{{ end }}">
                                "{{ .keputusan }}"
                            </p>
                            
                            {{ if .alasan_evaluasi }}
                            <p class="mt-3 text-sm leading-relaxed text-gray-500 dark:text-gray-400">
                                <span class="font-bold text-[10px] uppercase tracking-wider opacity-50 block mb-1">Konteks:</span>
                                {{ .alasan_evaluasi }}
                            </p>
                            {{ end }}
                        </div>
                        {{ end }}
                    </div>
                </section>

            </div>
        </div>

        <footer class="p-10 text-center bg-white dark:bg-gray-900 border-t border-gray-100 dark:border-gray-800">
            <a href="{{ .Parent.RelPermalink }}" class="flex items-center justify-center text-indigo-600 dark:text-indigo-400 hover:text-indigo-700 dark:hover:text-indigo-300 transition-colors">
                <!-- icon remix -->                 
                <i class="icon-[ri--arrow-left-line] mr-2"></i>
                Kembali ke Target Tahun Ini
            </a>
        </footer>
    </div>
</div>
</div>
{{ end }}