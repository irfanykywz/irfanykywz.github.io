{{ define "head" }}
    {{ partial "style.html" (dict "css" "css/project.css") }}
{{ end }}

{{ define "main" }}

    <main class="main">
        <section class="page-header">
            <div class="container">
                <h1 class="page-title">
                    <i class="ri-briefcase-2-line"></i>
                    {{ .Title }}
                </h1>
                <p class="page-description">{{ len .Data.Pages }} {{ .Description }}</p>
            </div>
        </section>

        <section class="portfolio-filters">
            <div class="container">
                <div class="filter-buttons">
                    {{ $filters := .Params.filtertab }}
                    {{ $visibleFiltersCount := 5 }}
                    
                    {{/* Visible Filters */}}
                    {{ range $index, $element := first $visibleFiltersCount $filters }}
                        <button class="filter-btn" data-filter="{{ $element.filter }}">
                            <i class="{{ $element.icon }}"></i>
                            {{ $element.name }}
                        </button>
                    {{- end -}}

                    {{/* Dropdown for More Filters */}}
                    {{ if gt (len $filters) $visibleFiltersCount }}
                        <div class="filter-dropdown">
                            <button class="filter-btn" id="more-filters-btn">
                                <i class="ri-more-2-fill"></i>
                            </button>
                            <div class="filter-dropdown-content" id="more-filters-content">
                                {{ range after $visibleFiltersCount $filters }}
                                    <a href="#" class="filter-dropdown-item" data-filter="{{ .filter }}">
                                        <i class="{{ .icon }}"></i>
                                        {{ .name }}
                                    </a>
                                {{ end }}
                            </div>
                        </div>
                    {{ end }}
                </div>
            </div>
        </section>

        <section class="portfolio-grid">
            <div class="container">
                <div class="projects-grid">
                    {{ range .Data.Pages }}
                        {{ partial "project/list-card.html" . }}
                    {{ end }}

                </div>
            </div>
        </section>

        {{ partial "cta.html" . }}
        
    </main>

{{ end }}

{{ define "footer" }}

    {{ partial "view-count-js.html" . }}

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const filterContainer = document.querySelector('.portfolio-filters');
            if (!filterContainer) return;

            const filterButtons = filterContainer.querySelectorAll('.filter-btn:not(#more-filters-btn)');
            const projectItems = document.querySelectorAll('.project-item');
            const moreFiltersBtn = document.getElementById('more-filters-btn');
            const moreFiltersContent = document.getElementById('more-filters-content');
            const dropdownItems = document.querySelectorAll('.filter-dropdown-item');

            function applyFilter(filterValue) {
                let activeFilterFoundInVisible = false;

                // Update active state for visible buttons
                filterButtons.forEach(btn => {
                    const isActive = btn.getAttribute('data-filter') === filterValue;
                    btn.classList.toggle('active', isActive);
                    if (isActive) activeFilterFoundInVisible = true;
                });

                // Update active state for "More" button if filter is from dropdown
                if (moreFiltersBtn) {
                    moreFiltersBtn.classList.toggle('active', !activeFilterFoundInVisible);
                }

                // Show/hide project items
                projectItems.forEach(item => {
                    const itemCategory = item.getAttribute('data-category');
                    const shouldShow = (filterValue === 'all' || itemCategory === filterValue);
                    item.style.display = shouldShow ? 'block' : 'none';
                });
            }

            function updateUrl(filterValue) {
                const url = new URL(window.location);
                url.searchParams.set('filter', filterValue);
                window.history.pushState({}, '', url);
            }

            // Event listener for visible filter buttons
            filterButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const filterValue = button.getAttribute('data-filter');
                    updateUrl(filterValue);
                    applyFilter(filterValue);
                });
            });

            // Event listener for dropdown items
            dropdownItems.forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    const filterValue = item.getAttribute('data-filter');
                    updateUrl(filterValue);
                    applyFilter(filterValue);
                    if (moreFiltersContent) moreFiltersContent.style.display = 'none'; // Hide dropdown
                });
            });

            // Logic to toggle dropdown
            if (moreFiltersBtn) {
                moreFiltersBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    moreFiltersContent.style.display = moreFiltersContent.style.display === 'block' ? 'none' : 'block';
                });
            }

            // Close dropdown if clicking outside
            window.addEventListener('click', (e) => {
                if (moreFiltersContent && moreFiltersContent.style.display === 'block') {
                    if (!moreFiltersBtn.contains(e.target)) {
                        moreFiltersContent.style.display = 'none';
                    }
                }
            });

            // Initial load check
            const urlParams = new URLSearchParams(window.location.search);
            const filterFromUrl = urlParams.get('filter');
            const initialFilter = filterFromUrl || (filterContainer.querySelector('.filter-btn')?.getAttribute('data-filter') || 'all');
            applyFilter(initialFilter);
        });
    </script>
{{ end }}