{{ define "head" }}
    {{ partial "style.html" (dict "css" "css/service.css") }}
{{ end }}

{{ define "main" }}
<div class="container service-page-container">
    <header class="service-header">
        <h1 class="page-title">{{ .Title }}</h1>
        {{ with .Description }}
            <p class="page-description">{{ . }}</p>
        {{ end }}
    </header>

    <div class="post-content-full">
        {{ if .Params.services }}
        {{ $contactPage := .Site.GetPage "contact" }}
        <div class="service-slider-wrapper">
            <button class="slider-nav-btn prev" aria-label="Layanan sebelumnya">
                <i class="ri-arrow-left-s-line"></i>
            </button>
            <div class="service-grid">
                {{ range .Params.services }}
                <div class="service-card{{ if .popular }} popular-card{{ end }}">
                    {{ if .popular }}
                    <div class="service-badge">Paling Populer</div>
                    {{ end }}
                    <div class="service-icon-wrapper">
                        <i class="{{ .icon }} service-icon"></i>
                    </div>

                    <h3 class="service-title">{{ .title }}</h3>
                    
                    <p class="service-description">{{ .description }}</p>

                    {{ if .features }}
                    <ul class="service-features">
                        {{ range .features }}
                        <li><i class="ri-checkbox-circle-line"></i> {{ . }}</li>
                        {{ end }}
                    </ul>
                    {{ end }}

                    {{ with .price }}
                    <p class="service-price">Mulai dari <strong>{{ . }}</strong></p>
                    {{ end }}

                    {{ $messageText := .message | default (printf "Halo, saya tertarik dengan layanan *%s*." .title) | urlize }}
                    <a href="https://api.whatsapp.com/send?phone={{ replace ($contactPage.Params.whatsapp) "https://api.whatsapp.com/send?phone=" "" | replace "&text=Halo, Saya dapat kontak dari website." "" }}&text={{ $messageText }}" class="service-contact-btn" target="_blank">Hubungi Saya</a>
                </div>
                {{ end }}
            </div>
            <button class="slider-nav-btn next" aria-label="Layanan berikutnya">
                <i class="ri-arrow-right-s-line"></i>
            </button>
        </div>
        <div class="slider-dots-container"></div>
        {{ end }}
    </div>

</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const sliderWrapper = document.querySelector('.service-slider-wrapper');
    if (!sliderWrapper) return;

    const serviceGrid = sliderWrapper.querySelector('.service-grid');
    const prevBtn = sliderWrapper.querySelector('.slider-nav-btn.prev');
    const nextBtn = sliderWrapper.querySelector('.slider-nav-btn.next');
    const scrollAmount = 350 + 32; // card width + gap
    let autoPlayInterval;

    const startAutoPlay = () => {
        autoPlayInterval = setInterval(() => {
            // If scrolled to the end, go back to the start
            if (serviceGrid.scrollLeft + serviceGrid.clientWidth >= serviceGrid.scrollWidth - 1) { // -1 for precision
                serviceGrid.scrollTo({ left: 0, behavior: 'smooth' });
            } else {
                serviceGrid.scrollBy({ left: scrollAmount, behavior: 'smooth' });
            }
        }, 5000); // Ganti slide setiap 5 detik
    };

    const stopAutoPlay = () => {
        clearInterval(autoPlayInterval);
    };

    const resetAutoPlay = () => {
        stopAutoPlay();
        startAutoPlay();
    };

    // Dots indicators
    const sliderDotsContainer = document.querySelector('.slider-dots-container');
    const numServices = serviceGrid.children.length;

    for (let i = 0; i < numServices; i++) {
        const dot = document.createElement('button');
        dot.classList.add('slider-dot');
        dot.setAttribute('data-index', i);
        dot.setAttribute('aria-label', `Go to service ${i + 1}`);
        dot.addEventListener('click', () => {
            serviceGrid.scrollTo({
                left: i * scrollAmount,
                behavior: 'smooth'
            });
            resetAutoPlay();
        });
        sliderDotsContainer.appendChild(dot);
    }

    const updateDots = () => {
        const currentServiceIndex = Math.round(serviceGrid.scrollLeft / scrollAmount);
        sliderDotsContainer.querySelectorAll('.slider-dot').forEach((dot, index) => {
            dot.classList.toggle('active', index === currentServiceIndex);
        });
    };

    // Panggil sekali saat load untuk mengaktifkan titik pertama
    updateDots();

    prevBtn.addEventListener('click', () => {
        serviceGrid.scrollBy({ left: -scrollAmount, behavior: 'smooth' });
        resetAutoPlay();
    });

    nextBtn.addEventListener('click', () => {
        serviceGrid.scrollBy({ left: scrollAmount, behavior: 'smooth' });
        resetAutoPlay();
    });

    // Stop autoplay on hover for desktop and on touch for mobile
    sliderWrapper.addEventListener('mouseenter', stopAutoPlay);
    sliderWrapper.addEventListener('mouseleave', startAutoPlay);
    sliderWrapper.addEventListener('touchstart', stopAutoPlay, { passive: true });
    sliderWrapper.addEventListener('touchend', startAutoPlay, { passive: true });

    // Update dots on scroll
    serviceGrid.addEventListener('scroll', updateDots);

    startAutoPlay();
});


</script>

{{ end }}